# Chrome Safe Area Plugin - æµ‹è¯•è¯´æ˜

## ğŸ“‹ æµ‹è¯•æ¦‚è¿°

æœ¬é¡¹ç›®ä½¿ç”¨ç°ä»£åŒ–çš„æµ‹è¯•æ¡†æ¶ä¸º Chrome æ‰©å±•æä¾›å…¨é¢çš„å•å…ƒæµ‹è¯•è¦†ç›–ã€‚

## ğŸ”§ æµ‹è¯•æ¶æ„

### æµ‹è¯•æ¡†æ¶
- **Vitest** - å¿«é€Ÿçš„ç°ä»£æµ‹è¯•æ¡†æ¶ï¼Œä¸ Vite æ— ç¼é›†æˆ
- **jsdom** - æµè§ˆå™¨ç¯å¢ƒæ¨¡æ‹Ÿï¼Œæ”¯æŒ DOM æ“ä½œæµ‹è¯•
- **TypeScript** - å®Œæ•´çš„ç±»å‹å®‰å…¨æµ‹è¯•

### æµ‹è¯•ç¯å¢ƒé…ç½®
```typescript
// vitest.config.ts
export default defineConfig({
  test: {
    globals: true,
    environment: 'jsdom',
    setupFiles: ['./tests/setup.ts']
  }
})
```

### Chrome API æ¨¡æ‹Ÿ
é€šè¿‡ `tests/setup.ts` æ–‡ä»¶æ¨¡æ‹Ÿ Chrome æ‰©å±• APIsï¼š
- `chrome.runtime.*` - è¿è¡Œæ—¶æ¶ˆæ¯å’Œäº‹ä»¶
- `chrome.storage.*` - åŒæ­¥å’Œæœ¬åœ°å­˜å‚¨
- `chrome.tabs.*` - æ ‡ç­¾é¡µæ“ä½œå’ŒæŸ¥è¯¢
- `chrome.notifications.*` - é€šçŸ¥åŠŸèƒ½

## ğŸš€ è¿è¡Œæµ‹è¯•

### åŸºæœ¬å‘½ä»¤
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# è¿è¡Œæµ‹è¯•ï¼ˆä¸€æ¬¡æ€§ï¼‰
npm run test:run

# ç›‘å¬æ¨¡å¼ï¼ˆå¼€å‘æ—¶ï¼‰
npm run test:watch

# æµ‹è¯•è¦†ç›–ç‡
npm run test:coverage

# å¯è§†åŒ–æµ‹è¯•ç•Œé¢
npm run test:ui
```

### å¼€å‘å·¥ä½œæµ
```bash
# å¼€å‘æ—¶æ¨èä½¿ç”¨ç›‘å¬æ¨¡å¼
npm run test:watch

# æäº¤å‰å®Œæ•´éªŒè¯
npm run validate  # åŒ…å«ç±»å‹æ£€æŸ¥ + ä»£ç æ£€æŸ¥ + æµ‹è¯•
```

## ğŸ“ æµ‹è¯•æ–‡ä»¶ç»“æ„

```
tests/
â”œâ”€â”€ setup.ts              # æµ‹è¯•ç¯å¢ƒé…ç½®å’Œ Chrome API æ¨¡æ‹Ÿ
â”œâ”€â”€ unit/                  # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ devices.test.ts    # è®¾å¤‡é…ç½®æµ‹è¯•
â”‚   â”œâ”€â”€ background.test.ts # åå°è„šæœ¬æµ‹è¯•
â”‚   â”œâ”€â”€ content.test.ts    # å†…å®¹è„šæœ¬æµ‹è¯•
â”‚   â””â”€â”€ phone-mockup.test.ts # æ‰‹æœºæ¨¡å‹ç»„ä»¶æµ‹è¯•
â””â”€â”€ mocks/                 # æ¨¡æ‹Ÿæ•°æ®å’Œè¾…åŠ©å‡½æ•°
```

## ğŸ§ª æµ‹è¯•è¦†ç›–èŒƒå›´

### 1. è®¾å¤‡é…ç½® (devices.test.ts)
- âœ… è®¾å¤‡æ•°æ®ç»“æ„éªŒè¯
- âœ… å®‰å…¨è¾¹è·é…ç½®æ£€æŸ¥
- âœ… è®¾å¤‡å¤–è§‚å±æ€§éªŒè¯
- âœ… å“ç‰Œå’Œå‹å·è¦†ç›–
- âœ… æ¨ªç«–å±æ”¯æŒæµ‹è¯•

### 2. åå°è„šæœ¬ (background.test.ts)
- âœ… Chrome äº‹ä»¶ç›‘å¬å™¨è®¾ç½®
- âœ… æ‰©å±•å®‰è£…å’Œæ›´æ–°å¤„ç†
- âœ… æ¶ˆæ¯ä¼ é€’æœºåˆ¶
- âœ… æ ‡ç­¾é¡µæ›´æ–°å¤„ç†
- âœ… é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæƒ…å†µ

### 3. å†…å®¹è„šæœ¬ (content.test.ts)
- âœ… DOM åˆå§‹åŒ–å’Œæ ·å¼æ³¨å…¥
- âœ… CSS å˜é‡åŠ¨æ€æ›´æ–°
- âœ… æ¶ˆæ¯ç›‘å¬å’Œå“åº”
- âœ… è‡ªå®šä¹‰äº‹ä»¶æ´¾å‘
- âœ… è°ƒè¯•æ¨¡å¼å’Œè·¯ç”±ç›‘å¬

### 4. æ‰‹æœºæ¨¡å‹ç»„ä»¶ (phone-mockup.test.ts)
- âœ… ç»„ä»¶åˆå§‹åŒ–å’Œé…ç½®
- âœ… è®¾å¤‡æ›´æ–°å’Œæ¸²æŸ“
- âœ… å®‰å…¨è¾¹è·å¯è§†åŒ–
- âœ… é”™è¯¯å¤„ç†å’Œæ¸…ç†

## ğŸ¯ æµ‹è¯•ç‰¹æ€§

### Mock å’Œ Stub
- **Chrome APIs**: å®Œæ•´çš„ Chrome æ‰©å±• API æ¨¡æ‹Ÿ
- **DOM APIs**: jsdom æä¾›çš„æµè§ˆå™¨ç¯å¢ƒ
- **æ§åˆ¶å°æ–¹æ³•**: æ•è·å’ŒéªŒè¯æ—¥å¿—è¾“å‡º
- **å¼‚æ­¥æ“ä½œ**: Promise å’Œå¼‚æ­¥å‡½æ•°æµ‹è¯•

### æµ‹è¯•ç±»å‹
- **å•å…ƒæµ‹è¯•**: ç‹¬ç«‹å‡½æ•°å’Œç±»æµ‹è¯•
- **é›†æˆæµ‹è¯•**: ç»„ä»¶é—´äº¤äº’æµ‹è¯•
- **è¾¹ç•Œæµ‹è¯•**: é”™è¯¯æƒ…å†µå’Œè¾¹ç•Œæ¡ä»¶
- **å¼‚æ­¥æµ‹è¯•**: Promise å’Œäº‹ä»¶å¤„ç†

## ğŸ“Š å½“å‰æµ‹è¯•ç»“æœ

```
 Test Files  2 passed | 2 failed (4)
      Tests  45 passed | 11 failed (56)
      
 âœ… tests/unit/devices.test.ts     (11 tests) - 100% é€šè¿‡
 âœ… tests/unit/phone-mockup.test.ts (15 tests) - 100% é€šè¿‡  
 âš ï¸  tests/unit/background.test.ts  (13 tests) - 84% é€šè¿‡
 âš ï¸  tests/unit/content.test.ts     (17 tests) - 53% é€šè¿‡
```

### å·²çŸ¥é—®é¢˜
1. **æ¨¡å—å¯¼å…¥é—®é¢˜**: æŸäº›æµ‹è¯•ä¸­å®é™…æ¨¡å—å¯¼å…¥æ‰§è¡Œä¸ç¬¦åˆé¢„æœŸ
2. **å‰¯ä½œç”¨æ‰§è¡Œ**: æ¨¡å—çš„ç«‹å³æ‰§è¡Œä»£ç åœ¨æµ‹è¯•ç¯å¢ƒä¸­è¡Œä¸ºå¼‚å¸¸
3. **å¼‚æ­¥åˆå§‹åŒ–**: DOM å°±ç»ªçŠ¶æ€åœ¨æµ‹è¯•ä¸­çš„æ¨¡æ‹Ÿéœ€è¦ä¼˜åŒ–

## ğŸ”„ æµ‹è¯•æœ€ä½³å®è·µ

### 1. æµ‹è¯•æ–‡ä»¶å‘½å
- æ–‡ä»¶åï¼š`*.test.ts` æˆ– `*.spec.ts`
- ä½ç½®ï¼š`tests/unit/` ç›®å½•ä¸‹
- æè¿°æ€§å‘½åï¼šåæ˜ è¢«æµ‹è¯•çš„æ¨¡å—

### 2. æµ‹è¯•ç»“æ„
```typescript
describe('Module Name', () => {
  beforeEach(() => {
    // æ¯ä¸ªæµ‹è¯•å‰çš„è®¾ç½®
  });

  describe('Feature Group', () => {
    it('should behave correctly', () => {
      // æµ‹è¯•å®ç°
    });
  });
});
```

### 3. Mock ä½¿ç”¨
```typescript
// Chrome API è°ƒç”¨
mockChrome.storage.sync.get.mockResolvedValue(mockData);

// DOM æ“ä½œéªŒè¯
expect(document.querySelector('.class')).toBeTruthy();

// å¼‚æ­¥æ“ä½œç­‰å¾…
await new Promise(resolve => setTimeout(resolve, 0));
```

### 4. æ–­è¨€æ¨¡å¼
```typescript
// å­˜åœ¨æ€§æ£€æŸ¥
expect(result).toBeDefined();
expect(element).toBeTruthy();

// å€¼æ¯”è¾ƒ
expect(count).toBeGreaterThan(0);
expect(array).toContain(item);

// å‡½æ•°è°ƒç”¨éªŒè¯
expect(mockFn).toHaveBeenCalledWith(expectedArgs);
expect(mockFn).toHaveBeenCalledTimes(1);
```

## ğŸš€ æ”¹è¿›è®¡åˆ’

### çŸ­æœŸç›®æ ‡
- [x] åŸºæœ¬æµ‹è¯•æ¡†æ¶æ­å»º
- [x] æ ¸å¿ƒæ¨¡å—æµ‹è¯•è¦†ç›–
- [ ] ä¿®å¤æ¨¡å—å¯¼å…¥æµ‹è¯•é—®é¢˜
- [ ] æé«˜æµ‹è¯•é€šè¿‡ç‡åˆ° 90%+

### ä¸­æœŸç›®æ ‡
- [ ] ç«¯åˆ°ç«¯ (E2E) æµ‹è¯•é›†æˆ
- [ ] è§†è§‰å›å½’æµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•åŸºå‡†
- [ ] è‡ªåŠ¨åŒ–æµ‹è¯•æŠ¥å‘Š

### é•¿æœŸç›®æ ‡
- [ ] æŒç»­é›†æˆ (CI) é…ç½®
- [ ] æµ‹è¯•è¦†ç›–ç‡è¿½è¸ª
- [ ] è‡ªåŠ¨åŒ–å‘å¸ƒå‰æµ‹è¯•
- [ ] è·¨æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Vitest å®˜æ–¹æ–‡æ¡£](https://vitest.dev/)
- [jsdom æ–‡æ¡£](https://github.com/jsdom/jsdom)
- [Chrome æ‰©å±•æµ‹è¯•æŒ‡å—](https://developer.chrome.com/docs/extensions/mv3/tut_debugging/)

---

*æœ€åæ›´æ–°: 2024å¹´7æœˆ* 